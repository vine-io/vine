<!doctype html>
<html lang="zh" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.95.0" /><link rel="canonical" type="text/html" href="https://vine-io.github.io/vine/docs/quickstart/">
<link rel="alternate" type="application/rss&#43;xml" href="https://vine-io.github.io/vine/docs/quickstart/index.xml">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/vine/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/vine/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/vine/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/vine/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/vine/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/vine/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/vine/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/vine/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/vine/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/vine/favicons/android-192x192.png" sizes="192x192">

<title>快速开始 | Vine</title><meta property="og:title" content="快速开始" />
<meta property="og:description" content="Vine 文档" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://vine-io.github.io/vine/docs/quickstart/" /><meta property="og:site_name" content="Vine" />

<meta itemprop="name" content="快速开始">
<meta itemprop="description" content="Vine 文档"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="快速开始"/>
<meta name="twitter:description" content="Vine 文档"/>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-00000000-0', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>






<link rel="preload" href="/vine/scss/main.min.bd19fcdf38c012b14ad8d3c8432efd8cf1740a17234311f030bcb495e955a2cf.css" as="style">
<link href="/vine/scss/main.min.bd19fcdf38c012b14ad8d3c8432efd8cf1740a17234311f030bcb495e955a2cf.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>




  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/vine/">
		<span class="navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Vine</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link active" href="/vine/docs/" ><span class="active">文档</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a  class="nav-link" href="https://github.com/vine-io/examples" target="_blank" ><span>实例</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a  class="nav-link" href="https://github.com/vine-io/vine" target="_blank" ><span>GitHub</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
<input type="search" class="form-control td-search-input" placeholder="&#xf002 站内搜索…" aria-label="站内搜索…" autocomplete="off">

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/vine/docs/quickstart/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">快速开始</h1>






<div class="content">
      <p>这里提供一个简单的实例，帮助用户快速了解 <strong>Vine</strong> 框架。</p>
<h2 id="定义接口">定义接口</h2>
<h3 id="新建项目">新建项目</h3>
<p>新建目录保存相关代码:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir <span style="color:#8be9fd;font-style:italic">$GOPATH</span>/src/greet
</span></span></code></pre></div><blockquote>
<p>建议项目保存在 $GOPATH 下</p>
</blockquote>
<h3 id="新建-proto-文件">新建 *.proto 文件</h3>
<p><strong>Vine</strong> 内部使用 <code>gRPC</code> 作为服务端，<code>*.proto</code> 是 google 公司开源的一种数据交换协议，类似 <code>json</code>。关于 <code>protobuf</code> 更详细的语法可以参考<a href="https://developers.google.com/protocol-buffers/docs/gotutorial">protobuf</a>。</p>
<p>这里我们新建 <code>greet.proto</code> 文件，内容如下:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-protobuf" data-lang="protobuf"><span style="display:flex;"><span><span style="color:#6272a4">// mysite/proto/greet.proto
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>syntax <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;proto3&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">package</span> greet;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">service</span> Greeter {
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">rpc</span> Echo(EchoReq) <span style="color:#ff79c6">returns</span> (EchoRsp) {}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">message</span> <span style="color:#50fa7b">EchoReq</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd">string</span> name <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">message</span> <span style="color:#50fa7b">EchoRsp</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd">string</span> greeting <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>更多的关于 <strong>Vine</strong> 的语法规则可以参考 <a href="/vine/docs/guides/openapi/">protoc-gen-vine</a></p>
</blockquote>
<h3 id="生成-api-接口">生成 API 接口</h3>
<p>你需要以下的工具来生成 proto 代码</p>
<ul>
<li><a href="https://github.com/protocolbuffers/protobuf">protoc</a></li>
<li><a href="https://github.com/vine-io/vine/tree/master/cmd/protoc-gen-gogo">protoc-gen-gogo</a></li>
<li><a href="https://github.com/vine-io/vine/tree/master/cmd/protoc-gen-vine">protoc-gen-vine</a></li>
</ul>
<p>使用 protoc、protoc-gen-gogo、protoc-gen-vine 来生成 protobuf code</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go get github.com/gogo/protobuf
</span></span><span style="display:flex;"><span>go get github.com/vine-io/vine/cmd/protoc-gen-gogo
</span></span><span style="display:flex;"><span>go get github.com/vine-io/vine/cmd/protoc-gen-vine
</span></span></code></pre></div><p>使用命令生成 <code>greet.pb.go</code> 和 <code>greet.vine.go</code> 文件:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">cd</span> <span style="color:#8be9fd;font-style:italic">$GOPATH</span>/src
</span></span><span style="display:flex;"><span>protoc -I<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">$GOPATH</span>/src --gogo_out<span style="color:#ff79c6">=</span>:. --vine_out<span style="color:#ff79c6">=</span>:. mysite/proto/greet.proto
</span></span></code></pre></div><p>执行成功后会生成新的文件:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mysite
</span></span><span style="display:flex;"><span>└── proto
</span></span><span style="display:flex;"><span>    ├── greet.pb.go       <span style="color:#6272a4"># 通过 protoc-gen-gogo 插件生成，包含结构体和 gRPC 的接口</span>
</span></span><span style="display:flex;"><span>    ├── greet.pb.vine.go  <span style="color:#6272a4"># 通过 protoc-gen-vine 插件生成，包含 Vine 框架接口</span>
</span></span><span style="display:flex;"><span>    └── greet.proto
</span></span></code></pre></div><h2 id="定义服务">定义服务</h2>
<h3 id="实现-vine-服务">实现 Vine 服务</h3>
<p>有了 proto 文件后，接下来就是编写服务端代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mkdir -p server
</span></span><span style="display:flex;"><span>touch mysite/server/main.go
</span></span></code></pre></div><p>服务端代码:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff79c6">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;github.com/vine-io/vine&#34;</span>
</span></span><span style="display:flex;"><span>	pb <span style="color:#f1fa8c">&#34;mysite/proto&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// greet 需要实现 pb.Greet 的接口
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">type</span> greet <span style="color:#8be9fd;font-style:italic">struct</span> {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> (g <span style="color:#ff79c6">*</span>greet) <span style="color:#50fa7b">Echo</span>(ctx context.Context, req <span style="color:#ff79c6">*</span>pb.EchoReq, rsp <span style="color:#ff79c6">*</span>pb.EchoRsp) <span style="color:#8be9fd">error</span> {
</span></span><span style="display:flex;"><span>	rsp.Greeting = <span style="color:#f1fa8c">&#34;hello: &#34;</span> <span style="color:#ff79c6">+</span> req.Name
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 构建新的服务
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	app <span style="color:#ff79c6">:=</span> vine.<span style="color:#50fa7b">NewService</span>(
</span></span><span style="display:flex;"><span>		vine.<span style="color:#50fa7b">Name</span>(<span style="color:#f1fa8c">&#34;greet&#34;</span>),
</span></span><span style="display:flex;"><span>	)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 服务初始化
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	app.<span style="color:#50fa7b">Init</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 注册服务
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">:=</span> pb.<span style="color:#50fa7b">RegisterGreeterHandler</span>(app.<span style="color:#50fa7b">Server</span>(), <span style="color:#ff79c6">&amp;</span>greet{}); err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>		log.<span style="color:#50fa7b">Fatalf</span>(<span style="color:#f1fa8c">&#34;register greet hander: %v&#34;</span>, err)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 服务启动
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">:=</span> app.<span style="color:#50fa7b">Run</span>(); err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>		log.<span style="color:#50fa7b">Fatalf</span>(<span style="color:#f1fa8c">&#34;start greet server: %v&#34;</span>, err)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这样一个简易的 <strong>Vine</strong> 服务就完成了。</p>
<blockquote>
<p>更多服务端的内容请参考 <a href="/vine/docs/component/server/">内部服务</a></p>
</blockquote>
<h3 id="启动服务">启动服务</h3>
<p>启动服务并绑定端口:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go run server/main.go
</span></span><span style="display:flex;"><span>2021-08-27 13:24:18  <span style="color:#8be9fd;font-style:italic">file</span><span style="color:#ff79c6">=</span>vine/service.go:171 <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info Starting <span style="color:#ff79c6">[</span>service<span style="color:#ff79c6">]</span> greet
</span></span><span style="display:flex;"><span>2021-08-27 13:24:18  <span style="color:#8be9fd;font-style:italic">file</span><span style="color:#ff79c6">=</span>vine/service.go:172 <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info service <span style="color:#ff79c6">[</span>version<span style="color:#ff79c6">]</span> latest
</span></span><span style="display:flex;"><span>2021-08-27 13:24:18  <span style="color:#8be9fd;font-style:italic">file</span><span style="color:#ff79c6">=</span>grpc/grpc.go:920 <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info Server <span style="color:#ff79c6">[</span>grpc<span style="color:#ff79c6">]</span> Listening on <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:65235
</span></span><span style="display:flex;"><span>2021-08-27 13:24:18  <span style="color:#8be9fd;font-style:italic">file</span><span style="color:#ff79c6">=</span>grpc/grpc.go:761 <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info Registry <span style="color:#ff79c6">[</span>mdns<span style="color:#ff79c6">]</span> Registering node: greet-d4d5e1a8-1bc0-4387-8fb2-1b5eda59055e
</span></span><span style="display:flex;"><span>2021-08-27 13:24:18  <span style="color:#8be9fd;font-style:italic">file</span><span style="color:#ff79c6">=</span>mdns/mdns_registry.go:266 <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info <span style="color:#ff79c6">[</span>mdns<span style="color:#ff79c6">]</span> registry create new service with ip: 192.168.11.167 <span style="color:#ff79c6">for</span>: 192.168.11.167
</span></span></code></pre></div><p>如果用户没有指定 ip 和端口，则默认 ip 为 0.0.0.0，端口随机生成。</p>
<blockquote>
<p>关于 <strong>Vine</strong> 服务的命令行参数可以参考 <a href="/vine/docs/component/cmd/">命令行参数</a></p>
</blockquote>
<h2 id="客户端">客户端</h2>
<p>接下来我们编写客户端的代码来请求服务端:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir -p client
</span></span><span style="display:flex;"><span>touch client/main.go
</span></span></code></pre></div><p>客户端代码:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff79c6">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;github.com/vine-io/vine/core/client/grpc&#34;</span>
</span></span><span style="display:flex;"><span>	log <span style="color:#f1fa8c">&#34;github.com/vine-io/vine/lib/logger&#34;</span>
</span></span><span style="display:flex;"><span>	pb <span style="color:#f1fa8c">&#34;github.com/vine-io/vine/testdata/mysite/proto&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 选择 gRPC 客户端
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	cc <span style="color:#ff79c6">:=</span> grpc.<span style="color:#50fa7b">NewClient</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 指定服务名称
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	client <span style="color:#ff79c6">:=</span> pb.<span style="color:#50fa7b">NewGreeterService</span>(<span style="color:#f1fa8c">&#34;greet&#34;</span>, cc)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">// 请求 Greet.Echo 接口
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	rsp, err <span style="color:#ff79c6">:=</span> client.<span style="color:#50fa7b">Echo</span>(context.<span style="color:#50fa7b">TODO</span>(), <span style="color:#ff79c6">&amp;</span>pb.EchoReq{Name: <span style="color:#f1fa8c">&#34;lack&#34;</span>})
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span>		log.<span style="color:#50fa7b">Fatal</span>(err)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	log.<span style="color:#50fa7b">Infof</span>(<span style="color:#f1fa8c">&#34;greet result: %v&#34;</span>, rsp.Greeting)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>执行命令输出如下:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go run client/main.go
</span></span><span style="display:flex;"><span>2021-08-27 13:24:41  <span style="color:#8be9fd;font-style:italic">file</span><span style="color:#ff79c6">=</span>client/main.go:20 <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info greet result: hello: lack
</span></span></code></pre></div><blockquote>
<p>更多关于客户端的内容可以参考 <a href="/vine/docs/component/client/">内部请求</a></p>
</blockquote>
<h2 id="api-接口">API 接口</h2>
<p><strong>Vine</strong> 服务可以同时支持 <code>gRPC</code> 和 <code>Restful</code> 接口。</p>
<h3 id="修改-greetproto-文件">修改 greet.proto 文件</h3>
<p>先修改 greet.proto 文件:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-protobuf" data-lang="protobuf"><span style="display:flex;"><span>syntax <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;proto3&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">package</span> greet;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// +gen:openapi
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">service</span> Greeter {
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// +gen:get=/api/v1/echo
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#ff79c6">rpc</span> Echo(EchoReq) <span style="color:#ff79c6">returns</span> (EchoRsp) {}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">message</span> <span style="color:#50fa7b">EchoReq</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd">string</span> name <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">message</span> <span style="color:#50fa7b">EchoRsp</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd">string</span> greeting <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>重新生成 <code>greet.pb.vine.go</code> 文件:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>protoc -I<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">$GOPATH</span>/src --vine_out<span style="color:#ff79c6">=</span>:.  github.com/vine-io/vine/testdata/mysite/proto/greet.proto
</span></span></code></pre></div><h3 id="安装-vine">安装 <code>vine</code>:</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go get github.com/vine-io/vine/cmd/vine
</span></span></code></pre></div><h3 id="启动网关">启动网关</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vine api --handler<span style="color:#ff79c6">=</span>rpc --enable-openapi  
</span></span><span style="display:flex;"><span>2021-08-27 13:38:54  <span style="color:#8be9fd;font-style:italic">file</span><span style="color:#ff79c6">=</span>openapi/openapi.go:56 <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info Starting OpenAPI at /openapi-ui/
</span></span><span style="display:flex;"><span>2021-08-27 13:38:54  <span style="color:#8be9fd;font-style:italic">file</span><span style="color:#ff79c6">=</span>api/api.go:179 <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info Registering API RPC Handler at /
</span></span><span style="display:flex;"><span>2021-08-27 13:38:54  <span style="color:#8be9fd;font-style:italic">file</span><span style="color:#ff79c6">=</span>http/http.go:116 <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info HTTP API Listening on <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:8080
</span></span><span style="display:flex;"><span>2021-08-27 13:38:54  <span style="color:#8be9fd;font-style:italic">file</span><span style="color:#ff79c6">=</span>vine/service.go:171 <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info Starting <span style="color:#ff79c6">[</span>service<span style="color:#ff79c6">]</span> go.vine.api
</span></span><span style="display:flex;"><span>2021-08-27 13:38:54  <span style="color:#8be9fd;font-style:italic">file</span><span style="color:#ff79c6">=</span>vine/service.go:172 <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info service <span style="color:#ff79c6">[</span>version<span style="color:#ff79c6">]</span> latest
</span></span><span style="display:flex;"><span>2021-08-27 13:38:54  <span style="color:#8be9fd;font-style:italic">file</span><span style="color:#ff79c6">=</span>grpc/grpc.go:920 <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info Server <span style="color:#ff79c6">[</span>grpc<span style="color:#ff79c6">]</span> Listening on <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:50405
</span></span><span style="display:flex;"><span>2021-08-27 13:38:54  <span style="color:#8be9fd;font-style:italic">file</span><span style="color:#ff79c6">=</span>grpc/grpc.go:761 <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info Registry <span style="color:#ff79c6">[</span>mdns<span style="color:#ff79c6">]</span> Registering node: go.vine.api-b405ca1d-ba24-4470-a18e-b1feeb22c5f6
</span></span><span style="display:flex;"><span>2021-08-27 13:38:54  <span style="color:#8be9fd;font-style:italic">file</span><span style="color:#ff79c6">=</span>mdns/mdns_registry.go:266 <span style="color:#8be9fd;font-style:italic">level</span><span style="color:#ff79c6">=</span>info <span style="color:#ff79c6">[</span>mdns<span style="color:#ff79c6">]</span> registry create new service with ip: 192.168.11.167 <span style="color:#ff79c6">for</span>: 192.168.11.167
</span></span></code></pre></div><p>使用以下命令验证:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl http://127.0.0.1:8080/api/v1/echo<span style="color:#f1fa8c">\?</span>name<span style="color:#f1fa8c">\=</span>lack
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">{</span><span style="color:#f1fa8c">&#34;greeting&#34;</span>:<span style="color:#f1fa8c">&#34;hello: lack&#34;</span><span style="color:#ff79c6">}</span>%
</span></span></code></pre></div><p>完成的目录结构如下:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mysite
</span></span><span style="display:flex;"><span>├── client
</span></span><span style="display:flex;"><span>│   └── main.go
</span></span><span style="display:flex;"><span>├── proto
</span></span><span style="display:flex;"><span>│   ├── greet.pb.go
</span></span><span style="display:flex;"><span>│   ├── greet.pb.vine.go
</span></span><span style="display:flex;"><span>│   └── greet.proto
</span></span><span style="display:flex;"><span>└── server
</span></span><span style="display:flex;"><span>    └── main.go
</span></span></code></pre></div>
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2ca5b21c2e8606490b4d2c267c683e14">1 - 框架简介</h1>
    
	<p><a href="https://opensource.org/licenses/Apache-2.0"><img src="https://img.shields.io/:license-apache-blue.svg" alt="License"></a> <a href="https://pkg.go.dev/github.com/vine-io/vine?tab=doc"><img src="https://img.shields.io/badge/go.dev-reference-007d9c?logo=go&amp;logoColor=white&amp;style=flat-square" alt="Go.Dev reference"></a> <a href="https://travis-ci.org/vine-io/vine"><img src="https://api.travis-ci.org/vine-io/vine.svg?branch=master" alt="Travis CI"></a> <a href="https://goreportcard.com/report/github.com/vine-io/vine"><img src="https://goreportcard.com/badge/vine-io/vine" alt="Go Report Card"></a></p>
<p>Vine (<em>/vaɪn/</em>) 一套简单、高效、可插拔的分布式 RPC 框架。</p>
<blockquote>
<p>Vine (葡萄树 🍇) : 我们希望它能像的它名字一样，多节果子。</p>
</blockquote>
<h2 id="简介">简介</h2>
<p><strong>Vine</strong> 基于 <a href="https://github.com/asim/go-micro">go-micro</a> 框架，因此继承了它的优点。并在此基础上进行裁剪和改进，增加性能和可用性。</p>
<h2 id="架构图">架构图</h2>
<p><img src="vine%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt="vine架构图"></p>
<h2 id="功能">功能</h2>
<p><strong>Vine</strong> 抽象化分布式系统的内部细节. 以下是主要功能.</p>
<ul>
<li>
<p><strong>动态配置 (Dynamic Config)</strong> - 从任意地方加载和热加载动态配置。配置接口提供了一种方法，可以从任何源（如环境变量，文件，etcd）加载应用级别配置。同时支持合并源、甚至定义回退。</p>
</li>
<li>
<p><strong>数据存储 (Dao)</strong> - 一个简单的数据存储接口，用于查询，创建，删除数据记录。内置 memory，file，postgresSQL 等</p>
</li>
<li>
<p><strong>缓存接口 (Cache)</strong> - 支持内部数据缓存，保存临时数据。</p>
</li>
<li>
<p><strong>服务发现 (Service discovery)</strong> - 自动服务注册和名称解析。服务发现是微服务开发的核心功能。当服务A与服务B通讯时，需要知道服务B的IP地址等信息。<strong>Vine</strong> 内置(mdns)作为服务发现组件，它是零配置系统。</p>
</li>
<li>
<p><strong>负载均衡 (Load Balancing)</strong> - 基于服务发现的客户端负载均衡。当内部存在多个服务实例的地址时，我们需要一种方式确定路由到哪个节点，默认使用随机指定其中一个地址。同时在请求错误时重试不同的节点。</p>
</li>
<li>
<p><strong>消息编码 (Message Encoding)</strong> - 基于<code>Content-Type</code>的动态消息编码。Codec 为客户端和服务端提供 Go 类型的编码和解码，支持各种不同的类型。默认使用 protobuf 和 json。</p>
</li>
<li>
<p><strong>gRPC 传输 (gRPC transport)</strong> - 基于 gRPC 的请求响应，同时支持双向流。<strong>Vine</strong> 为同步通讯提供一个抽象，使发向服务的请求被自动解析、负载均衡、拨号和流化。</p>
</li>
<li>
<p><strong>异步消息 (Async Messaging)</strong> - 内置订阅发布模型，作为异步通讯和事件驱动架构。事件通知属于微服务开发中的核心模式。默认的消息系统为 HTTP 事件代理。</p>
</li>
<li>
<p><strong>同步 (Synchronization)</strong> - 分布式系统通常以最终一致性的方式构建。内置的 <strong>Sync</strong> 接口实现分布式锁和领导选举。</p>
</li>
<li>
<p><strong>可插拔接口 (Pluggable Interfaces)</strong> - 得益于 Go 语言的抽象特性。 <strong>Vine</strong> 为每个模块提供抽象接口，正因为如此，这些接口都是可插拔的。可以在 <a href="https://github.com/vine-io/plugins">github.com/vine-io/plugins</a> 查询你需要的插件。</p>
</li>
</ul>
<h2 id="许可">许可</h2>
<p>Vine 遵守 MIT License 开源许可.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-83087925151d27e6b8d84f40aff9cdee">2 - 新建项目</h1>
    
	<h2 id="依赖">依赖</h2>
<p>新建 <strong>Vine</strong> 项目需要安装依赖环境和工具:</p>
<ul>
<li><a href="https://golang.org/dl/">go</a></li>
<li><a href="https://github.com/protocolbuffers/protobuf">protoc</a></li>
</ul>
<p>建议开启GO111MODULE</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go env -w <span style="color:#8be9fd;font-style:italic">GO111MODULE</span><span style="color:#ff79c6">=</span>on
</span></span></code></pre></div><h2 id="安装">安装</h2>
<p>安装 <strong>Vine</strong> 工具</p>
<p>go get 安装</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go get -u github.com/vine-io/vine/cmd/vine@latest
</span></span><span style="display:flex;"><span>go get -u github.com/vine-io/vine/cmd/protoc-gen-gogo@latest
</span></span><span style="display:flex;"><span>go get -u github.com/vine-io/vine/cmd/protoc-gen-vine@latest
</span></span></code></pre></div><p>go install 安装</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go install github.com/vine-io/vine/cmd/vine@latest
</span></span><span style="display:flex;"><span>go install github.com/vine-io/vine/cmd/protoc-gen-gogo@latest
</span></span><span style="display:flex;"><span>go install github.com/vine-io/vine/cmd/protoc-gen-vine@latest
</span></span></code></pre></div><p>源码编译安装</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com/vine-io/vine
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">cd</span> vine
</span></span><span style="display:flex;"><span>make build <span style="color:#ff79c6">&amp;&amp;</span> mv vine <span style="color:#8be9fd;font-style:italic">$GOPATH</span>/bin/vine 
</span></span></code></pre></div><h2 id="创建项目">创建项目</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#6272a4"># 新建项目根目录</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#8be9fd;font-style:italic">$GOPATH</span>/src/helloworld
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">cd</span> <span style="color:#8be9fd;font-style:italic">$GOPATH</span>/src/helloworld
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 初始化目录</span>
</span></span><span style="display:flex;"><span>vine init
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 新建服务</span>
</span></span><span style="display:flex;"><span>vine new service helloworld
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 生成代码</span>
</span></span><span style="display:flex;"><span>vine build proto
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 安装依赖</span>
</span></span><span style="display:flex;"><span>go mod vendor
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 启动服务</span>
</span></span><span style="display:flex;"><span>vine run helloworld
</span></span></code></pre></div><h2 id="启动服务">启动服务</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vine run helloworld
</span></span></code></pre></div><h2 id="启动网关">启动网关</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vine api --handler<span style="color:#ff79c6">=</span>rpc --enable-openapi
</span></span></code></pre></div><h2 id="测试">测试</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -X POST http://127.0.0.1:8080/foo/v1/foo/Call -H <span style="color:#f1fa8c">&#34;Content-Type: application/json&#34;</span>  -d <span style="color:#f1fa8c">&#34;{\&#34;name\&#34;:\&#34;World\&#34;}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># {&#34;msg&#34;:&#34;reply: World&#34;}</span>
</span></span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-67790003301156bb2bbfd3d432c5d2f6">3 - 项目结构</h1>
    
	<p><strong>Vine</strong> 提供命令行工具创建项目，其中包括了开发过程中需要的工具链和部署内容。符合 DDD 设计规范。</p>
<h2 id="单服务">单服务</h2>
<p>单服务目录结构使用以下命令创建:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir <span style="color:#8be9fd;font-style:italic">$PATH</span>/src/foo
</span></span><span style="display:flex;"><span>vine init
</span></span><span style="display:flex;"><span>vine new service foo
</span></span></code></pre></div><p>生成目录结构:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>├── Makefile
</span></span><span style="display:flex;"><span>├── README.md
</span></span><span style="display:flex;"><span>├── api  // ------ 维护 grpc 接口，和 domain 层中领域模型
</span></span><span style="display:flex;"><span>│   └── service
</span></span><span style="display:flex;"><span>│       └── foo
</span></span><span style="display:flex;"><span>│           └── v1
</span></span><span style="display:flex;"><span>│               ├── foo.pb.go
</span></span><span style="display:flex;"><span>│               ├── foo.pb.validator.go
</span></span><span style="display:flex;"><span>│               ├── foo.pb.vine.go
</span></span><span style="display:flex;"><span>│               └── foo.proto
</span></span><span style="display:flex;"><span>├── cmd         // ------ 项目入口
</span></span><span style="display:flex;"><span>│   └── main.go
</span></span><span style="display:flex;"><span>├── deploy    // ------- 部署相关工具
</span></span><span style="display:flex;"><span>│   ├── Dockerfile
</span></span><span style="display:flex;"><span>│   ├── foo.ini
</span></span><span style="display:flex;"><span>│   └── foo.service
</span></span><span style="display:flex;"><span>├── go.mod
</span></span><span style="display:flex;"><span>├── go.sum
</span></span><span style="display:flex;"><span>├── pkg  // 服务内部代码
</span></span><span style="display:flex;"><span>│   ├── app.go  // -------- 构造和组合各层代码，提供给 cmd/main.go
</span></span><span style="display:flex;"><span>│   ├── biz  // ---------- DDD 的 domain 层，维护业务代码
</span></span><span style="display:flex;"><span>│   │   └── foo.go
</span></span><span style="display:flex;"><span>│   ├── infra  // --------- DDD 的 infrastructure 层，底层通用代码
</span></span><span style="display:flex;"><span>│   │   ├── cache  // -------- 缓存相关
</span></span><span style="display:flex;"><span>│   │   │   └── cache.go
</span></span><span style="display:flex;"><span>│   │   └── storage  // ------- 数据库 storage，数据交互
</span></span><span style="display:flex;"><span>│   │       └── storage.go
</span></span><span style="display:flex;"><span>│   ├── service   // ---------- DDD 的 interfaces 层，提供对外的 gRPC 接口 
</span></span><span style="display:flex;"><span>│   │   └── foo.go
</span></span><span style="display:flex;"><span>│   └── internal
</span></span><span style="display:flex;"><span>└── vine.toml   // -------- vine 项目的描述文件
</span></span></code></pre></div><h2 id="多服务">多服务</h2>
<p>当一个项目中有多个微服务时，我们推荐代码在一个目录中维护，使用以下命令创建</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir -p <span style="color:#8be9fd;font-style:italic">$GOPATH</span>/src/cluster
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">cd</span> <span style="color:#8be9fd;font-style:italic">$GOPATH</span>/src/cluster
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vine init --cluster
</span></span><span style="display:flex;"><span>vine new service helloworld
</span></span></code></pre></div><p>生成以下目录结构:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>├── Makefile
</span></span><span style="display:flex;"><span>├── README.md
</span></span><span style="display:flex;"><span>├── api
</span></span><span style="display:flex;"><span>│   └── service
</span></span><span style="display:flex;"><span>│       └── helloworld
</span></span><span style="display:flex;"><span>│           └── v1
</span></span><span style="display:flex;"><span>│               └── helloworld.proto
</span></span><span style="display:flex;"><span>├── cmd
</span></span><span style="display:flex;"><span>│   └── helloworld
</span></span><span style="display:flex;"><span>│       └── main.go
</span></span><span style="display:flex;"><span>├── deploy
</span></span><span style="display:flex;"><span>│   ├── config
</span></span><span style="display:flex;"><span>│   │   └── helloworld.ini
</span></span><span style="display:flex;"><span>│   ├── docker
</span></span><span style="display:flex;"><span>│   │   └── helloworld
</span></span><span style="display:flex;"><span>│   │       └── Dockerfile
</span></span><span style="display:flex;"><span>│   └── systemd
</span></span><span style="display:flex;"><span>│       └── helloworld.service
</span></span><span style="display:flex;"><span>├── go.mod
</span></span><span style="display:flex;"><span>├── pkg   
</span></span><span style="display:flex;"><span>│   ├── helloworld // -------- 多服务是，pkg 每个目录代码一个服务
</span></span><span style="display:flex;"><span>│   │   ├── app.go
</span></span><span style="display:flex;"><span>│   │   ├── biz
</span></span><span style="display:flex;"><span>│   │   │   └── helloworld.go
</span></span><span style="display:flex;"><span>│   │   ├── infra
</span></span><span style="display:flex;"><span>│   │   │   ├── cache
</span></span><span style="display:flex;"><span>│   │   │   │   └── cache.go
</span></span><span style="display:flex;"><span>│   │   │   └── storage
</span></span><span style="display:flex;"><span>│   │   │       └── storage.go
</span></span><span style="display:flex;"><span>│   │   └── service
</span></span><span style="display:flex;"><span>│   │       └── helloworld.go
</span></span><span style="display:flex;"><span>│   └── internal  // ------ 多个服务间的通用代码
</span></span><span style="display:flex;"><span>└── vine.toml
</span></span></code></pre></div><h2 id="vinetoml">vine.toml</h2>
<p><code>vine.toml</code> 是 <strong>Vine</strong> 项目的描述文件，当一个目录底下存在该文件时，会被识别为 <strong>Vine</strong> 项目。</p>
<p><code>vine.toml</code> 存在两种格式，single 和 cluster。</p>
<h3 id="single">single</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff79c6">[</span>package<span style="color:#ff79c6">]</span>               <span style="color:#6272a4"># [package] 描述项目的公共信息 </span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">kind</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;single&#34;</span>         <span style="color:#6272a4"># 项目类型 single 和 cluster</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">namespace</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;go.vine&#34;</span>   <span style="color:#6272a4"># 统一的命名空间</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[</span>pkg<span style="color:#ff79c6">]</span>      <span style="color:#6272a4"># single 项目详细信息</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">name</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;foo&#34;</span>  <span style="color:#6272a4"># 项目名称</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">alias</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;go.vine.service.foo&#34;</span> <span style="color:#6272a4"># 服务名称</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">type</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;service&#34;</span>    <span style="color:#6272a4"># 服务类型 service, gateway</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">version</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;latest&#34;</span>  <span style="color:#6272a4"># 服务版本</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">main</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;cmd/main.go&#34;</span> <span style="color:#6272a4"># 服务入口文件</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">dir</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;github.com/lack-io/foo&#34;</span>  <span style="color:#6272a4"># 服务核心代码目录</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">output</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>  <span style="color:#6272a4"># 编译成二进制文件的存放目录</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">flags</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">[</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;-a&#34;</span>, <span style="color:#f1fa8c">&#34;-installsuffix&#34;</span>, <span style="color:#f1fa8c">&#34;cgo&#34;</span>, <span style="color:#f1fa8c">&#34;-ldflags \&#34;-s -w\&#34;&#34;</span>,  <span style="color:#6272a4"># 编译参数, 支持shell命令作为值 &#34;name=$(echo hello)&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[[</span>proto<span style="color:#ff79c6">]]</span>    <span style="color:#6272a4"># *.proto 文件信息</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">name</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;foo&#34;</span> <span style="color:#6272a4"># proto 文件名称</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">pb</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;github.com/lack-io/foo/api/service/foo/v1/foo.proto&#34;</span> <span style="color:#6272a4"># proto 文件路径</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">type</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;service&#34;</span> <span style="color:#6272a4"># proto 类型 service 和 api； service 表示 gRPC 服务，api 表示领域模型</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">group</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;foo&#34;</span> <span style="color:#6272a4"># proto 分组</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">version</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;v1&#34;</span> <span style="color:#6272a4"># proto 版本</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">plugins</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">[</span><span style="color:#f1fa8c">&#34;gogo&#34;</span>, <span style="color:#f1fa8c">&#34;vine&#34;</span>, <span style="color:#f1fa8c">&#34;validator&#34;</span><span style="color:#ff79c6">]</span> <span style="color:#6272a4"># 执行 protoc 命令时携带的插件，可选 gogo、vine、validator、deepcopy、dao</span>
</span></span></code></pre></div><h3 id="cluster">cluster</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff79c6">[</span>package<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">kind</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;cluster&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">namespace</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;go.vine&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[[</span>mod<span style="color:#ff79c6">]]</span>  <span style="color:#6272a4"># 每个 mod 表示一个服务</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">name</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;helloworld&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">alias</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;go.vine.service.helloworld&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">type</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;service&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">version</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;latest&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">main</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;cmd/helloworld/main.go&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">dir</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;github.com/lack-io/foo/helloworld&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">output</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">flags</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">[</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f1fa8c">&#34;-a&#34;</span>, <span style="color:#f1fa8c">&#34;-installsuffix&#34;</span>, <span style="color:#f1fa8c">&#34;cgo&#34;</span>, <span style="color:#f1fa8c">&#34;-ldflags \&#34;-s -w\&#34;&#34;</span>, 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">[[</span>proto<span style="color:#ff79c6">]]</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">name</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;helloworld&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">pb</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;github.com/lack-io/foo/api/service/helloworld/v1/helloworld.proto&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">type</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;service&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">group</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;helloworld&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">version</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;v1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">plugins</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">[</span><span style="color:#f1fa8c">&#34;gogo&#34;</span>, <span style="color:#f1fa8c">&#34;vine&#34;</span>, <span style="color:#f1fa8c">&#34;validator&#34;</span><span style="color:#ff79c6">]</span>
</span></span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-79e475706ae8025baf8c0f923eec34bd">4 - 构建工具</h1>
    
	<p>我们提供一套工具帮助开发者快速构建微服务。</p>
<h2 id="安装">安装</h2>
<p>使用 go get 安装</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go get -u github.com/vine-io/vine/cmd/vine@latest
</span></span></code></pre></div><p>编译包安装 (推荐)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://github.com/vine-io/vine/releases/download/v0.23.0/vine-darwin-amd64-v0.23.0.tar.gz
</span></span><span style="display:flex;"><span>tar -xvf vine-darwin-amd64-v0.23.0.tar.gz
</span></span><span style="display:flex;"><span>cp -r darwin-amd64/* <span style="color:#8be9fd;font-style:italic">$GOPATH</span>/bin/
</span></span></code></pre></div><p>工具使用</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vine --version
</span></span><span style="display:flex;"><span>&gt; v0.23.0-8b25f36c-1630374346
</span></span></code></pre></div><h2 id="新建项目">新建项目</h2>
<p>创建目录作为项目根目录</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir -p <span style="color:#8be9fd;font-style:italic">$GOPATH</span>/src/foo
</span></span></code></pre></div><p>初始化目录</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">cd</span> <span style="color:#8be9fd;font-style:italic">$GOPATH</span>/src/foo
</span></span><span style="display:flex;"><span>vine init
</span></span></code></pre></div><p><code>vine init [--cluster]</code> 会初始化 <strong>Vine</strong> 项目，生成以下文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── vine.toml  <span style="color:#6272a4"># vine 项目的描述文件，包括项目名称，服务接口和proto等信息。</span>
</span></span><span style="display:flex;"><span>├── README.md
</span></span><span style="display:flex;"><span>├── .gitignore
</span></span><span style="display:flex;"><span>└── go.mod
</span></span></code></pre></div><h2 id="新建服务">新建服务</h2>
<p>在初始化的目录新建微服务：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vine new service foo
</span></span></code></pre></div><blockquote>
<p>vine 项目类型为 single 时，<code>vine new service</code> 指定服务名称是无效的，它的名称等于目录名。</p>
</blockquote>
<p>执行结果，生成以下文档:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── cmd
</span></span><span style="display:flex;"><span>│   └── main.go
</span></span><span style="display:flex;"><span>├── pkg
</span></span><span style="display:flex;"><span>│   ├── runtime
</span></span><span style="display:flex;"><span>│   │   ├── doc.go
</span></span><span style="display:flex;"><span>│   │   └── inject
</span></span><span style="display:flex;"><span>│   │       └── inject.go
</span></span><span style="display:flex;"><span>│   ├── app.go
</span></span><span style="display:flex;"><span>│   ├── interfaces
</span></span><span style="display:flex;"><span>│   │   └── foo.go
</span></span><span style="display:flex;"><span>│   ├── app
</span></span><span style="display:flex;"><span>│   │   └── foo.go
</span></span><span style="display:flex;"><span>│   ├── biz
</span></span><span style="display:flex;"><span>│   │   └── foo.go
</span></span><span style="display:flex;"><span>│   └── infra
</span></span><span style="display:flex;"><span>│       ├── storage
</span></span><span style="display:flex;"><span>│       │   └── storage.go
</span></span><span style="display:flex;"><span>│       └── cache
</span></span><span style="display:flex;"><span>│           └── cache.go
</span></span><span style="display:flex;"><span>├── deploy
</span></span><span style="display:flex;"><span>│   ├── Dockerfile
</span></span><span style="display:flex;"><span>│   ├── foo.ini
</span></span><span style="display:flex;"><span>│   └── foo.service
</span></span><span style="display:flex;"><span>├── api
</span></span><span style="display:flex;"><span>│   └── service
</span></span><span style="display:flex;"><span>│       └── foo
</span></span><span style="display:flex;"><span>│           └── v1
</span></span><span style="display:flex;"><span>│               └── foo.proto
</span></span><span style="display:flex;"><span>├── Makefile
</span></span><span style="display:flex;"><span>└── vine.toml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>download protoc zip packages <span style="color:#ff79c6">(</span>protoc-<span style="color:#8be9fd;font-style:italic">$VERSION</span>-<span style="color:#8be9fd;font-style:italic">$PLATFORM</span>.zip<span style="color:#ff79c6">)</span> and install:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>visit https://github.com/protocolbuffers/protobuf/releases
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>download protobuf <span style="color:#ff79c6">for</span> vine:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">cd</span> github.com/lack-io/foo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>install dependencies:
</span></span><span style="display:flex;"><span>        go get github.com/gogo/protobuf
</span></span><span style="display:flex;"><span>        go get github.com/vine-io/vine/cmd/protoc-gen-gogo
</span></span><span style="display:flex;"><span>        go get github.com/vine-io/vine/cmd/protoc-gen-vine
</span></span><span style="display:flex;"><span>        go get github.com/vine-io/vine/cmd/protoc-gen-validator
</span></span><span style="display:flex;"><span>        go get github.com/vine-io/vine/cmd/protoc-gen-deepcopy
</span></span><span style="display:flex;"><span>        go get github.com/vine-io/vine/cmd/protoc-gen-dao
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">cd</span> github.com/lack-io/foo
</span></span><span style="display:flex;"><span>        vine build foo
</span></span></code></pre></div><h2 id="安装依赖">安装依赖</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go get github.com/gogo/protobuf
</span></span><span style="display:flex;"><span>go get github.com/vine-io/vine/cmd/protoc-gen-gogo
</span></span><span style="display:flex;"><span>go get github.com/vine-io/vine/cmd/protoc-gen-vine
</span></span><span style="display:flex;"><span>go get github.com/vine-io/vine/cmd/protoc-gen-validator
</span></span><span style="display:flex;"><span>go get github.com/vine-io/vine/cmd/protoc-gen-deepcopy
</span></span><span style="display:flex;"><span>go get github.com/vine-io/vine/cmd/protoc-gen-dao
</span></span></code></pre></div><h2 id="更加-proto-文件生成-go-代码">更加 proto 文件生成 go 代码</h2>
<p>使用命令格式为: <code>vine build proto [command options] [proto_name]</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#6272a4"># 生成 vine.toml 中所有 proto 文件对应的代码。</span>
</span></span><span style="display:flex;"><span>vine new proto
</span></span></code></pre></div><p>支持如下参数:</p>
<ul>
<li>&ndash;type string                      指定 proto 文件的类型，支持 api 和 service，默认 api</li>
<li>&ndash;proto-version string, -v string  指定 proto 文件版本，默认 v1</li>
<li>&ndash;group string                     指定 proto 文件分组，默认 core</li>
<li>&ndash;dir string                       执行 protoc 命令是所在的目录，chroot</li>
<li>&ndash;path strings, -I strings         protoc -I 路径</li>
<li>&ndash;plugins strings, -P strings      生成 proto 时装载的插件</li>
</ul>
<h2 id="运行服务">运行服务</h2>
<p>命令格式: <code>vine new [command options] [name]</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vine run foo
</span></span></code></pre></div><p>支持如下参数:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>- --auto-restart                    监听文件变化时重启服务
</span></span><span style="display:flex;"><span>- --watch strings                   追加监听的路径
</span></span><span style="display:flex;"><span>- --watch-interval int64, -I int64  监听事件触发间隔，默认3s
</span></span></code></pre></div><h2 id="启动-api-网关">启动 api 网关</h2>
<p>命令格式: <code>vine api [command options]</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vine api --handler<span style="color:#ff79c6">=</span>rpc --enable-openapi
</span></span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1adf2527acb4bd9f3ca351337ddc8408">5 - 可选参数</h1>
    
	<h2 id="概述">概述</h2>
<p>创建新服务时，你可以选择传递其他参数，例如设置名称，版本，Broker，Registry 或者存储，以便与所有其他内部实现一起使用。
选项通常定义如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">type</span> Options <span style="color:#8be9fd;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>    Name        <span style="color:#8be9fd">string</span>
</span></span><span style="display:flex;"><span>    Version     <span style="color:#8be9fd">string</span>
</span></span><span style="display:flex;"><span>    Broker      broker.Broker
</span></span><span style="display:flex;"><span>    Registry    registry.Registry
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">type</span> Option <span style="color:#8be9fd;font-style:italic">func</span>(<span style="color:#ff79c6">*</span>Options)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// set the name
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">Name</span>(n <span style="color:#8be9fd">string</span>) Option {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">func</span>(o <span style="color:#ff79c6">*</span>Options) {
</span></span><span style="display:flex;"><span>        o.Name = n
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// set the broker
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">Broker</span>(b broker.Broker) Option {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">func</span>(o <span style="color:#ff79c6">*</span>Options) {
</span></span><span style="display:flex;"><span>        o.Broker = b
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>然后这安装如下方式设置这些选项</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>service <span style="color:#ff79c6">:=</span> vine.<span style="color:#50fa7b">NewService</span>(
</span></span><span style="display:flex;"><span>    vine.<span style="color:#50fa7b">Name</span>(<span style="color:#f1fa8c">&#34;foobar&#34;</span>),
</span></span><span style="display:flex;"><span>    vine.<span style="color:#50fa7b">Broker</span>(broker),
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><h2 id="服务-options">服务 options</h2>
<p>在 <strong>Vine</strong> 中，我们有可以设置多种选项，包括用于身份验证，配置和存储等内容的基础包。你可以使用 <code>service.Options()</code> 来访问这些。</p>
<p>auth、config、registry、cache 等包将默认为我们的零依赖插件。可以通过设置环境变量或者命令行参数来配置它们，在执行 <code>service.Init()</code> 后生效。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#6272a4">## as an env vars</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">VINE_CACHE</span><span style="color:#ff79c6">=</span>file go run main.go
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">## or as a flag</span>
</span></span><span style="display:flex;"><span>go run main.go --cache<span style="color:#ff79c6">=</span>file
</span></span></code></pre></div><h2 id="使用-options">使用 options</h2>
<p>在内部，可以通过选项访问存储：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>service <span style="color:#ff79c6">:=</span> vine.<span style="color:#50fa7b">NewService</span>(
</span></span><span style="display:flex;"><span>    vine.<span style="color:#50fa7b">Name</span>(<span style="color:#f1fa8c">&#34;foobar&#34;</span>),
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>service.<span style="color:#50fa7b">Init</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>store <span style="color:#ff79c6">:=</span> service.<span style="color:#50fa7b">Options</span>().Store
</span></span></code></pre></div><blockquote>
<p><strong>Vine</strong> 每个内部接口一般都有对应的选项，在插件中，额外的选项通常被保存在 <code>context.Context</code> 中。</p>
</blockquote>
<h2 id="自定义-options">自定义 options</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>custom <span style="color:#ff79c6">:=</span> <span style="color:#8be9fd;font-style:italic">func</span>(s <span style="color:#8be9fd">string</span>) vine.Option {
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">func</span>(o <span style="color:#ff79c6">*</span>vine.Options) {
</span></span><span style="display:flex;"><span>		o.Context = context.<span style="color:#50fa7b">WithValue</span>(o.Context, s, s)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>vine.<span style="color:#50fa7b">NewService</span>(<span style="color:#50fa7b">custom</span>(<span style="color:#f1fa8c">&#34;value&#34;</span>))
</span></span></code></pre></div><h2 id="所有-options">所有 options</h2>
<p>vine 服务初始化是，支持以下 options</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>vine.<span style="color:#50fa7b">Name</span>(),            <span style="color:#6272a4">// 微服务名称
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">Id</span>(),              <span style="color:#6272a4">// 微服务 uuid
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">Version</span>(),         <span style="color:#6272a4">// 微服务版本
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">Address</span>(),         <span style="color:#6272a4">// 微服务绑定地址
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">Metadata</span>(),        <span style="color:#6272a4">// 微服务 metadata
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">Server</span>(),          <span style="color:#6272a4">// 设置内部 Server 模块
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">Client</span>(),          <span style="color:#6272a4">// 设置内部 Client 模块
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">Selector</span>(),        <span style="color:#6272a4">// 设置 client selector 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">HandleSignal</span>(),    <span style="color:#6272a4">// 是否处理系统信号
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">Context</span>(),         <span style="color:#6272a4">// 设置 Context 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">Broker</span>(),          <span style="color:#6272a4">// 设置内部 broker 模块
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">Registry</span>(),        <span style="color:#6272a4">// 设置内部 Registry 模块
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">RegisterTTL</span>(),     <span style="color:#6272a4">// 服务注册有效时间
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">RegisterInterval</span>(), <span style="color:#6272a4">// 服务注册间隔，必须小于 ttl
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">Tracer</span>(),          <span style="color:#6272a4">// 设置 Trace 模块
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">Dialect</span>(),         <span style="color:#6272a4">// 设置 Dialect 模块
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">Cmd</span>(),             <span style="color:#6272a4">// 设置 Cmd 模块
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">Action</span>(),          <span style="color:#6272a4">// 设置 Cmd Action 回调函数
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">Flags</span>(),           <span style="color:#6272a4">// 添加 Cmd Flags 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">WrapHandler</span>(),     <span style="color:#6272a4">// 添加 Server 请求拦截器
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">WrapClient</span>(),      <span style="color:#6272a4">// 添加 Client 请求拦截器
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">WrapCall</span>(),        <span style="color:#6272a4">// 添加 Client Call 请求拦截器
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">WrapSubscriber</span>(),  <span style="color:#6272a4">// 添加 Broker 拦截器
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">BeforeStart</span>(),     <span style="color:#6272a4">// 追加服务 Start 方法前的回调
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">BeforeStop</span>(),      <span style="color:#6272a4">// 追加服务 Stop 方法前的回调
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">AfterStart</span>(),      <span style="color:#6272a4">// 追加服务 Start 方法后的回调
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>vine.<span style="color:#50fa7b">AfterStop</span>(),       <span style="color:#6272a4">// 追加服务 Stop 方法后的回调
</span></span></span></code></pre></div>
</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6315071e53a7aa2cbc40cd1587b5d32b">6 - 插件中心</h1>
    
	<h2 id="概述">概述</h2>
<p><strong>Vine</strong> 构建在 Go 接口之上。因此这些接口的实现是可插拔的。</p>
<p>默认情况下，<strong>Vine</strong> 只提供核心上每个接口的几个实现，但它完全是可插拔的。而额外的实现保存在 <a href="https://github.com/vine-io/plugins">plugins</a>。</p>
<h2 id="添加插件">添加插件</h2>
<p>如果要集成插件，只需将它们链接到单独的文件中并重新生成。
创建 plugins.go 文件并导入所需的插件：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff79c6">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// etcd registry
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    _ <span style="color:#f1fa8c">&#34;github.com/vine-io/plugins/registry/etcd&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// nats broker
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    _ <span style="color:#f1fa8c">&#34;github.com/vine-io/plugins/broker/nats&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>通过包含插件文件来构建应用程序：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go build -o service main.go plugins.go
</span></span></code></pre></div><p>使用插件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>service --registry<span style="color:#ff79c6">=</span>etcd --broker<span style="color:#ff79c6">=</span>nats
</span></span></code></pre></div><p>或者使用环境变量</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">VINE_REGISTRY</span><span style="color:#ff79c6">=</span>etcd <span style="color:#8be9fd;font-style:italic">VINE_BROKER</span><span style="color:#ff79c6">=</span>nats service
</span></span></code></pre></div><h2 id="插件选项">插件选项</h2>
<p>或者你可以将插件设置在选项中</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#ff79c6">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;github.com/vine-io/vine&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// etcd registry
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#f1fa8c">&#34;github.com/vine-io/plugins/registry/etcd&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// nats broker
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#f1fa8c">&#34;github.com/vine-io/plugins/broker/nats&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span>    registry <span style="color:#ff79c6">:=</span> etcd.<span style="color:#50fa7b">NewRegistry</span>()
</span></span><span style="display:flex;"><span>    broker <span style="color:#ff79c6">:=</span> nats.<span style="color:#50fa7b">NewBroker</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    service <span style="color:#ff79c6">:=</span> vine.<span style="color:#50fa7b">NewService</span>(
</span></span><span style="display:flex;"><span>        vine.<span style="color:#50fa7b">Name</span>(<span style="color:#f1fa8c">&#34;greeter&#34;</span>),
</span></span><span style="display:flex;"><span>        vine.<span style="color:#50fa7b">Registry</span>(registry),
</span></span><span style="display:flex;"><span>        vine.<span style="color:#50fa7b">Broker</span>(broker),
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    service.<span style="color:#50fa7b">Init</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    service.<span style="color:#50fa7b">Run</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="编写插件">编写插件</h2>
<p>插件是一个建立在 Go 接口上的概念。每个包都维护一个高级接口抽象。只需实现接口并将其作为服务选项传递给它即可.</p>
<p>服务发现接口称为 <a href="https://pkg.go.dev/github.com/vine-io/vine/core/registry#Registry">Registry</a>. 实现此接口的任何内容都可以用作 <strong>Registry</strong>。这同样适用于其他包.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">type</span> Registry <span style="color:#8be9fd;font-style:italic">interface</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">Init</span>(<span style="color:#ff79c6">...</span>Option) <span style="color:#8be9fd">error</span>
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">Options</span>() Options
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">Register</span>(<span style="color:#ff79c6">*</span>Service, <span style="color:#ff79c6">...</span>RegisterOption) <span style="color:#8be9fd">error</span>
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">Deregister</span>(<span style="color:#ff79c6">*</span>Service, <span style="color:#ff79c6">...</span>DeregisterOption) <span style="color:#8be9fd">error</span>
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">GetService</span>(<span style="color:#8be9fd">string</span>, <span style="color:#ff79c6">...</span>GetOption) ([]<span style="color:#ff79c6">*</span>Service, <span style="color:#8be9fd">error</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">ListServices</span>(<span style="color:#ff79c6">...</span>ListOption) ([]<span style="color:#ff79c6">*</span>Service, <span style="color:#8be9fd">error</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">Watch</span>(<span style="color:#ff79c6">...</span>WatchOption) (Watcher, <span style="color:#8be9fd">error</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">String</span>() <span style="color:#8be9fd">string</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>查阅 <a href="https://github.com/vine-io/plugins">plugins</a> 可以更好地了解实现细节。</p>
<h2 id="插件列表">插件列表</h2>
<p>Registry 插件:</p>
<ul>
<li><a href="https://github.com/vine-io/plugins/tree/main/registry/etcd">etcd</a></li>
</ul>
<p>Broker 插件:</p>
<ul>
<li><a href="https://github.com/vine-io/plugins/tree/main/broker/nats">nats</a></li>
<li><a href="https://github.com/vine-io/plugins/tree/main/broker/redis">redis</a></li>
</ul>
<p>Dao 插件:</p>
<ul>
<li><a href="https://github.com/vine-io/plugins/tree/main/dao/mysql">mysql</a></li>
<li><a href="https://github.com/vine-io/plugins/tree/main/dao/postgres">postgresql</a></li>
<li><a href="https://github.com/vine-io/plugins/tree/main/dao/sqlite">sqlite</a></li>
</ul>
<p>Cache 插件:</p>
<ul>
<li><a href="https://github.com/vine-io/plugins/tree/main/cache/redis">redis</a></li>
</ul>
<p>Sync 插件：</p>
<ul>
<li><a href="https://github.com/vine-io/plugins/tree/main/sync/etcd">etcd</a></li>
<li><a href="https://github.com/vine-io/plugins/tree/main/sync/memory">memory</a></li>
</ul>
<p>Logger 插件:</p>
<ul>
<li><a href="https://github.com/vine-io/plugins/tree/main/logger/zap">zap</a></li>
</ul>
<p>Config Source 插件：</p>
<ul>
<li><a href="https://github.com/vine-io/plugins/tree/main/config/source/configmap">configmap</a></li>
<li><a href="https://github.com/vine-io/plugins/tree/main/config/source/etcd">etcd</a></li>
</ul>
<p>Wrapper 类</p>
<p>熔断器:</p>
<ul>
<li><a href="https://github.com/vine-io/plugins/tree/main/wrapper/breaker/gobreaker">gobreaker</a></li>
<li><a href="https://github.com/vine-io/plugins/tree/main/wrapper/breaker/hystrix">hystrix</a></li>
</ul>
<p>限流器:</p>
<ul>
<li><a href="https://github.com/vine-io/plugins/tree/main/wrapper/ratelimiter/ratelimiter">ratelimiter</a></li>
<li><a href="https://github.com/vine-io/plugins/tree/main/wrapper/ratelimiter/uber">uber</a></li>
</ul>
<p>链路追踪:</p>
<ul>
<li><a href="https://github.com/vine-io/plugins/tree/main/wrapper/trace/opentracing">opentracing</a></li>
</ul>
<p>数据校验:</p>
<ul>
<li><a href="https://github.com/vine-io/plugins/tree/main/wrapper/validator">validator</a></li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="" aria-label="">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="">
      <i class=""></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 The Docsy Authors All Rights Reserved</small>
        <small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank">隐私政策</a></small>
	
		<p class="mt-2"><a href="/vine/about/">关于</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>


<script src="https://cdn.jsdelivr.net/npm/mermaid@8.8.1/dist/mermaid.min.js" integrity="sha384-to2w0I1OqmbJ9J6yTnIX+KYU8grNpZoD1dKPLjgEJvMe5L5+/7qvuNa2sQo8WAWj" crossorigin="anonymous"></script>










<script src="/vine/js/main.min.163d123d0686e32440643e7e6a262d74812afcf72ef040b4512877d807100e4e.js" integrity="sha256-Fj0SPQaG4yRAZD5&#43;aiYtdIEq/Pcu8EC0USh32AcQDk4=" crossorigin="anonymous"></script>




  </body>
</html>
